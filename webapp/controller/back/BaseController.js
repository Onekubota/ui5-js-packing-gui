/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/ValueState","zscm/ewm/packoutbdlvs1/model/Global","zscm/ewm/packoutbdlvs1/modelHelper/Global","zscm/ewm/packoutbdlvs1/utils/Util","zscm/ewm/packoutbdlvs1/modelHelper/SerialNumber","zscm/ewm/packoutbdlvs1/modelHelper/Cache","zscm/ewm/packoutbdlvs1/utils/Const","zscm/ewm/packoutbdlvs1/modelHelper/PackingMode"],function(C,M,V,G,a,U,S,b,c,P){"use strict";var d="audio-player";return C.extend("zscm.ewm.packoutbdlvs1.controller.BaseController",{onInit:function(){this.setModel(G,"global");this.setModel(this.getOwnerComponent().getModel("i18n"),"i18n");this.initModel();this.initWorkFlow();this.initErrorHandler();this.initSubscription();this.init();this.oPersonalizationService=this.getPersonalizationService();this.getRouter().attachRouteMatched(function(e){var p=e.getParameters();if(p.name===this.sRouteName){if(U.isEmpty(a.getWarehouseNumber())||U.isEmpty(a.getPackStation())){if(this.sRouteName!==c.DEFAULT_ROUTE_NAME){this.getRouter().navTo("default",true);}}else{this.onRouteMatched(p.arguments);}if(p.name!==c.DEFAULT_ROUTE_NAME){this.publish(c.EVENT_BUS.CHANNELS.ROUTE_MATCHED,c.EVENT_BUS.EVENTS.SUCCESS);}}}.bind(this),this);},initModel:function(){},initWorkFlow:function(){},initErrorHandler:function(){},initSubscription:function(){},init:function(){},onRouteMatched:function(e){},oItemHelper:null,_updateInput:function(i,v,s,e){var I=i;if(typeof i==="string"){I=this.byId(i);}I.setValueState(v);I.setValueStateText(s);if(e!==undefined){I.setValue(e);}},onCancelDialog:function(e){e.getSource().getParent().close();this.setBusy(false);},updateInputWithDefault:function(i,v){this._updateInput(i,V.None,"",v);},updateInputWithWarning:function(i,w,v){this._updateInput(i,V.Warning,w,v);},updateInputWithSuccess:function(i,v){this._updateInput(i,V.Success,"",v);},updateInputWithError:function(i,e){var E="";if(U.isEmpty(e)){E=this.getI18nText("invalidEntry");}else{E=e;}this._updateInput(i,V.Error,E,"");},getI18nText:function(t,p){var i=this.getOwnerComponent().getModel("i18n");return i.getResourceBundle().getText(t,p);},setModel:function(m,n){this.getView().setModel(m,n);},getModel:function(m){return this.getOwnerComponent().getModel(m);},getGlobalModel:function(){return this.getView().getModel("global");},getSourceHU:function(){return this.getGlobalModel().getProperty("/sSourceHandlingUnit");},setSourceHU:function(v){this.getGlobalModel().setProperty("/sSourceHandlingUnit",v);},setInputEnable:function(i,e){var I=this.byId(i);I.setEnable(e);},focus:function(i){var I=i;if(typeof i==="string"){I=this.byId(i);}I.focus();return this;},getValue:function(i){var I=i;if(typeof i==="string"){I=this.byId(i);}return I.getValue();},getValueState:function(i){var I=i;if(typeof i==="string"){I=this.byId(i);}return I.getValueState();},displayInfoMessageBox:function(m){var e=!!this.getView().$().closest(".sapUiSizeCompact").length;M.information(m,{styleClass:e?"sapUiSizeCompact":""});this.playAudio(c.INFO);},showErrorMessageBox:function(m){var e=!!this.getView().$().closest(".sapUiSizeCompact").length;M.error(m,{styleClass:e?"sapUiSizeCompact":""});this.playAudio(c.ERROR);},setBusy:function(B){a.setBusy(!!B);},publish:function(s,e,p){this.getEventBus().publish(s,e,p);},subscribe:function(s,e,f){this.getEventBus().subscribe(s,e,f);},getEventBus:function(){return this.getOwnerComponent().getEventBus();},formatSerialIcon:function(s){var i="sap-icon://minimize";if(s){i="sap-icon://bullet-text";}return i;},formatEnableBtn:function(v){if(a.hasOpenShipHandlingUnit()){return true;}return false;},_mDialogPromise:null,openDialog:function(D){var t=this;if(this._mDialogPromise!==null){jQuery.sap.log.error("The prev closeDialog not called");}D.open();return new Promise(function(r,e){t._mDialogPromise={resolve:r,reject:e};});},cancelDialog:function(e){this.closeDialog(e.getSource().getParent(),c.ERRORS.INTERRUPT_WITH_NO_ACTION,true);this.setBusy(false);},closeDialog:function(D,v,r){if(this._mDialogPromise===null){jQuery.sap.log.error("openDialog/closeDialog must be pair worked");}D.close();if(r){this._mDialogPromise.reject(v);}else{this._mDialogPromise.resolve(v);}this._mDialogPromise=null;},openSerialNumberPopover:function(e,m,i){var I=e.getSource();var o=e.getSource().getBindingContext(m).getObject();var v=this.getView();var f=o.isIuidActive==c.ABAP_TRUE?true:false;var p=v.byId("serial-number-popover");var g=v.byId("serial-number-uii-popover");if(f){S.setSerialNumberUiisList(i.getItemSerialNumberUii(o));if(!g){g=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberUiiPopover",this);v.addDependent(g);}if(p){p.close();}g.openBy(I);}else{S.setSerialNumbersList(i.getItemSerialNumber(o));if(!p){p=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberPopover",this);v.addDependent(p);}if(g){g.close();}p.openBy(I);}},onAfterOpenSerialNumberPopover:function(e){e.getSource().focus();},checkQuantityOverflow:function(q,i){if(!isNaN(q)&&U.isQuantityOverflow(q)){var r=U.formatNumber(q,3);var w=this.getI18nText("roundUpQuantity");this.updateInputWithWarning(i,w,r);this.focus(i);return true;}return false;},getRouter:function(){return this.getOwnerComponent().getRouter();},navToHome:function(){var f=U.flushPendings.get();if(f){f().then(function(){var o=sap.ushell.Container.getService("CrossApplicationNavigation");var h=(o&&o.hrefForExternal({target:{shellHash:"#Shell-home"}}))||"";var u=window.location.href.split('#')[0]+h.split('?')[0];sap.m.URLHelper.redirect(u,false);}.bind(this));}},playAudio:function(m){var A=this.getAudioFromParent(this.oView);A.play(m);},getAudioFromParent:function(v){if(v.byId&&v.byId(d)){this.oAudio=v.byId(d);}else{this.getAudioFromParent(v.getParent());}return this.oAudio;},setButtonToolTip:function(i){var B=this.byId(i);if(U.isEmpty(B)){return;}var t=B.getTooltip();if(U.isEmpty(t)){B.setTooltip(B.getText());}},getTextAccordingToMode:function(i,o,p,m){var s=U.isEmpty(m)?P.getSelectedMode():m;var e="";if(s===c.INTERNAL_MODE){if(U.isEmpty(p)||p.length===0){e=this.getI18nText(i);}else{e=this.getI18nText(i,p);}}else{if(U.isEmpty(p)||p.length===0){e=this.getI18nText(o);}else{e=this.getI18nText(o,p);}}return e;},getPersonalizationService:function(){return sap.ushell.Container.getService("Personalization");},getPersonalizationContainer:function(){return new Promise(function(r,e){var s=this.getContainerId();this.oPersonalizationService.getContainer(s).fail(function(){var o=this.oPersonalizationService.createEmptyContainer(s);r(o);}.bind(this)).done(function(o){r(o);}.bind(this));}.bind(this));},getContainerId:function(){return P.getSelectedMode()!==c.INTERNAL_MODE?"zscm.ewm.packoutbdlvs1":"zscm.ewm.packoutbdlvs1.av1";}});});
