/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["zscm/ewm/packoutbdlvs1/controller/WorkFlowController","zscm/ewm/packoutbdlvs1/utils/CustomError","zscm/ewm/packoutbdlvs1/utils/Const","zscm/ewm/packoutbdlvs1/modelHelper/Global","zscm/ewm/packoutbdlvs1/modelHelper/Cache","zscm/ewm/packoutbdlvs1/utils/Util","sap/tl/ewm/lib/reuses1/controllers/Base.controller","zscm/ewm/packoutbdlvs1/modelHelper/OData","zscm/ewm/packoutbdlvs1/modelHelper/Items","sap/ui/model/json/JSONModel","zscm/ewm/packoutbdlvs1/modelHelper/SerialNumber","sap/m/ListMode","zscm/ewm/packoutbdlvs1/service/ODataService","sap/ui/core/ValueState","zscm/ewm/packoutbdlvs1/modelHelper/PackingMode","sap/m/MessageBox","zscm/ewm/packoutbdlvs1/model/AdvancedSourceTableSetting","zscm/ewm/packoutbdlvs1/modelHelper/ColumnSettings","zscm/ewm/packoutbdlvs1/model/PackingMode","zscm/ewm/packoutbdlvs1/model/BasicSourceTableSetting","zscm/ewm/packoutbdlvs1/model/InternalSourceTableSetting"],function(C,a,b,G,c,U,d,O,T,J,S,L,e,V,P,M,A,f,g,B,I){"use strict";var s="serialNumberDialog";var h="id-input-serialNumber";var j="stockLevelSnDialog";var k="stockLevel-sn-input";var l="batchDialog";var m="batch-input";var p="partial-pack-input";var n="difference-quantity-input";var o="damage-quantity-input";var q="id-input-serialNumber-difference-pack";var r="id-input-serialNumber-partial-pack";var t="id-input-serialNumber-damage-pack";var u="reductionDialog";return C.extend("zscm.ewm.packoutbdlvs1.controller.Left",{oItemHelper:new T(new J([])),oColumnSettingsHelper:new f(new J([])),initModel:function(){this.setModel(this.oItemHelper.getModel(),b.ITEM_MODEL_NAME);this.oProductForm=this.byId("product-info");this.oODOForm=this.byId("deliver-info");this.oProductHandlingInstr=this.byId("ProductHandlingInstr");this.oProductImage=this.byId("prod-image");this.sTableId="SourceProductTable";this.setModel(this.oColumnSettingsHelper.getModel(),b.COLUM_SETTING_MODEL_NAME);this.setModel(g,"packMode");},init:function(){this.setButtonToolTip("open-partial-pack-button");this.setButtonToolTip("pack-all-button");this.setButtonToolTip("pack-button");this.getRouter().attachRouteMatched(this.onRouteMatched,this);if(G.isOnCloud()){this.oProductImage.setVisible(false);}},removeDuplicatedId:function(){var i=this.getOwnerComponent().getId();var v=[b.ID.MAIN_SOURCE_VIEW,b.ID.MAIN_SHIP_VIEW,b.ID.INTERNAL_SOURCE_VIEW,b.ID.INTERNAL_SHIP_VIEW];var w=["pod---snuii--hbox","pod---snuii--snlabel"];var E;v.forEach(function(x){w.forEach(function(y){E=sap.ui.getCore().byId(i+x+y);if(E){E.destroy();}});});},getPersonlServiceContainerItemName:function(){if(P.isAdvancedMode()){return"advancedSourceTableSettings";}else if(P.isBasicMode()){return"basicSourceTableSettings";}else{return"internalSourceTableSettings";}},getDefaultColumnSettingNameInService:function(){if(P.isAdvancedMode()){return"advancedSourceDefaultSettings";}else if(P.isBasicMode()){return"basicSourceDefaultSettings";}else{return"internalSourceDefaultSettings";}},getDefaultColumnSetting:function(){if(P.isAdvancedMode()){return JSON.parse(JSON.stringify(this._mAdvancedSourceTableDefaultSettings));}else if(P.isBasicMode()){return JSON.parse(JSON.stringify(this._mBasicSourceDefaultDefaultSettings));}else{return JSON.parse(JSON.stringify(this._mInternalSourceTableDefaultSettings));}},getViewName:function(){return b.VIEW_SOURCE;},getTableSettingDialogName:function(){return"zscm.ewm.packoutbdlvs1.view.SourceTableSettingDialog";},initSubscription:function(){this.subscribe(b.EVENT_BUS.CHANNELS.USER_SETTING,b.EVENT_BUS.EVENTS.SUCCESS,function(){this.focus(b.ID.SOURCE_INPUT);}.bind(this));this.subscribe(b.EVENT_BUS.CHANNELS.EXCEPTION_LIST,b.EVENT_BUS.EVENTS.SUCCESS,function(i,E,R){this.initExceptionButtons(R);}.bind(this));this.subscribe(b.EVENT_BUS.CHANNELS.EXCEPTION_ENABLE,b.EVENT_BUS.EVENTS.SUCCESS,function(i,E){this.handleExceptionEnable();}.bind(this));this.subscribe(b.EVENT_BUS.CHANNELS.PACKALL_ENABLE,b.EVENT_BUS.EVENTS.SUCCESS,function(i,E){this.handlePackAllEnable();}.bind(this));this.subscribe(b.EVENT_BUS.CHANNELS.ROUTE_MATCHED,b.EVENT_BUS.EVENTS.SUCCESS,function(i,E){this.getWorkFlowFactory().getClearWorkFlow().run();}.bind(this));},onSourceInputChange:function(E){var i=U.trim(E.getParameter("newValue")).toUpperCase();this.getWorkFlowFactory().getSourceChangeWorkFlow().run({sReferenceNumber:i});},onPack:function(E){var i=this.oItemHelper.getItemByIndex(0);var v={oProduct:i,sQuantity:i.AlterQuan,iIndex:0,bAdd:true};this.getWorkFlowFactory().getPackItemWorkFlow().run(v);},onPackAll:function(){this.setBusy(true);var i=this.oItemHelper.getModel().getData();this.getWorkFlowFactory().getPackAllWorkFlow().run(i);},onProductChange:function(E){var i=U.trim(E.getParameter("newValue")).toUpperCase();var v=d.prototype.getAccessCodeList.call(this);var w=U.find(v,function(x){if(i===x.ExternalAccessCode){return true;}return false;});if(w){this.actionWithAccessCode(w);}else{this.getWorkFlowFactory().getProductChangeWorkFlow().run(i);}},isAccessCodeRelatedToSourceHU:function(i){switch(i){case b.ACCESS_CODE.PACK_ITEM:case b.ACCESS_CODE.PACK_ALL:return true;default:return false;}},isAccessCodeAllowedWhenPendingExist:function(i){switch(i){case b.ACCESS_CODE.PACK_ITEM:case b.ACCESS_CODE.CLOSE_HU:return true;default:return false;}},actionWithAccessCode:function(i){var E="";var v=i.InternalAccessCode;if(G.getPendingTaskNumber()>0&&!this.isAccessCodeAllowedWhenPendingExist(v)){this.updateInputWithError(b.ID.PRODUCT_INPUT,this.getI18nText("cannotPerformAccessCode"));this.focus(b.ID.PRODUCT_INPUT);return;}if(this.isAccessCodeRelatedToSourceHU(v)){if(U.isEmpty(G.getSourceId())){E="ACCESS_CODE_NO_SOURCE_SPECIFIED";}else if(this.oItemHelper.isEmpty()){E="ACCESS_CODE_SOURCE_EMPTY";}}switch(v){case b.ACCESS_CODE.PACK_ITEM:if(this.oItemHelper.isFirstItemHighlighted()){var w=this.oItemHelper.getItemByIndex(0);var x={oProduct:w,sQuantity:w.AlterQuan,iIndex:0,bAdd:true};this.getWorkFlowFactory().getPackItemWorkFlow().run(x);}else{E=E||"ACCESS_CODE_NOT_PRODUCT_SELECTED";}break;case b.ACCESS_CODE.PACK_ALL:if(G.getPackAllEnable()){this.onPackAll();}else{E=E||"ACCESS_CODE_PACK_ALL_DISABLE";}break;case b.ACCESS_CODE.CLOSE_HU:if(G.getCloseShipHUEnable()){this.updateInputWithDefault(b.ID.PRODUCT_INPUT,"");this.getWorkFlowFactory().getShipHUCloseWorkFlow().run();}else{E="ACCESS_CODE_CLOSE_HU_DISABLE";}break;case b.ACCESS_CODE.CREATE_HU:if(P.getSelectedMode()===b.ADVANCED_MODE||P.getSelectedMode()===b.INTERNAL_MODE){var y={};y.bOpen=true;this.getWorkFlowFactory().getShipHUCreationWorkFlow().run(y);}else{E=E||"ACCESS_CODE_CREATE_HU_DISABLE";}break;default:E="ACCESS_CODE_INVALID";}if(E){E="accessCodeNotApplicable";var z;if(U.isEmpty(i.Description)){z="";}else{z="("+i.Description+")";}var D=this.getI18nText(E,[i.ExternalAccessCode,z]);this.updateInputWithError(b.ID.PRODUCT_INPUT,D);this.playAudio(b.ERROR);this.focus(b.ID.PRODUCT_INPUT);}else{this.updateInputWithDefault(b.ID.PRODUCT_INPUT,"");}},verifyProductEAN:function(i){return new Promise(function(v,w){var x;if(U.isString(i)){x=i;e.verifyProduct(x).then(function(R){v(R.ProductName);}).catch(function(){w(x);});}else{v(i.ProductName);}}.bind(this));},getItemIndexByProductOrEAN:function(i,v){return new Promise(function(w,x){this.updateInputWithDefault(b.ID.PRODUCT_INPUT,"");var y;this.verifyProductEAN(i).then(function(z){v.sProduct=z;if(U.isString(i)){y=this.oItemHelper.getItemIndexByProduct(v.sProduct);}else{y=this.oItemHelper.getItemIndexByKey(i.StockItemUUID);}if(y!==-1){v.iItemIndex=y;if(G.getPendingTaskNumber()>0){var D=this.oItemHelper.getItemConsGroupByIndex(y);var E=c.getShipHUConsGroup(G.getCurrentShipHandlingUnit());if(E!==D){throw new a(b.ERRORS.PRODUCT_WITH_DIFF_CONS_GROUP);}}v.oProduct=this.oItemHelper.getItemByIndex(v.iItemIndex);w();}else{x(b.ERRORS.PRODUCT_NOT_IN_SOURCE);}}.bind(this)).catch(function(z){v.sProduct=z;x(b.ERRORS.PRODUCT_NOT_IN_SOURCE);}.bind(this));}.bind(this));},prepareDataForProductChangeWorkFlow:function(i){i.sProduct=this.oItemHelper.getItemProductByIndex(i.iItemIndex);var v=G.getCurrentShipHandlingUnit();i.sShipConsGroup=c.getShipHUConsGroup(v);G.setProductId(i.sProduct);},getItemIndexByProductAndActiveConsGroup:function(i){if(!U.isEmpty(i.sShipConsGroup)){var v=this.oItemHelper.getItemIndexByProductAndActiveConsGroup(i.oProduct,i.sShipConsGroup);if(v!==-1){i.iItemIndex=v;}}},sortTable:function(i){var v=this.oItemHelper.getItemStockIdByIndex(i.iItemIndex);this.oItemHelper.sortItemsByKey(v);},updateUIElementsAfterProductChange:function(){this.bindProductInfo();this.updateInputWithDefault(b.ID.PRODUCT_INPUT,"");this.focus(b.ID.PRODUCT_INPUT);this.handleHighLightFirstItem();},handleHighLightFirstItem:function(){var i=G.getCurrentShipHandlingUnit();if(!U.isEmpty(i)){var v=this.oItemHelper.getFirstItemConsGroup();var w=c.getShipHUConsGroup(i);this.oItemHelper.setItemsStatusByConsGrp();if(w===v||w===""){this.oItemHelper.setItemHighlightByIndex(0);}}else{this.oItemHelper.setItemsStatusByConsGrp();}},bindProductInfo:function(){var i=this.oItemHelper.getItemStockIdByIndex(0);var v=O.getProductPath(i);this.oProductForm.bindElement(v);this.oProductHandlingInstr.bindElement(v);},bindImage:function(){var i=this.oItemHelper.getItemStockIdByIndex(0);var v=O.getProductPath(i);this.oProductImage.bindElement(v);},unbindImage:function(){this.oProductImage.unbindElement();},unbindProductInfo:function(){this.oProductForm.unbindElement();this.oProductHandlingInstr.unbindElement();},prepareParemeterForCreation:function(i,v){v.sMaterialId=i.sMaterialId;v.oComponent=i.oDialog;v.sHuId=i.sHuId;v.sourceItems=this.oItemHelper.getItemsNum();v.isSingleConsGroupNoReduction=this.oItemHelper.isSingleConsGroupNoReduction();v.isSNEnable=this.oItemHelper.isSerialNumberEnable();if(this.oItemHelper.isEmpty()){v.sDocId="";}else{v.sDocId=this.oItemHelper.getItemDocIdByIndex(0);}},handleFocusAndHighlightForCreation:function(){if(U.isEmpty(G.getSourceId())){this.focus(b.ID.SOURCE_INPUT);}else{this.focus(b.ID.PRODUCT_INPUT);var i=G.getProductId();if(!U.isEmpty(i)){this.oItemHelper.setItemHighlightByIndex(0);}}},handlePackAllEnable:function(){var E=false;if(G.getPendingTaskNumber()===0&&this.oItemHelper.isSingleConsGroupNoReduction()&&!O.isShipHUClosed()&&!this.oItemHelper.isSerialNumberEnable()){E=this.canFirstSourceItemPackToCurrentShipHU();}G.setPackAllEnable(E);},onBeforeOpenPartialDialog:function(E){this.initUoMItems("partial-uom-select");this.updateInputWithDefault(p,"");},onBeforeOpenDifferenceDialog:function(E){this.initUoMItems("difference-uom-select");this.updateInputWithDefault(n,"");},onBeforeOpenDamageDialog:function(E){this.initUoMItems("damage-uom-select");this.updateInputWithDefault(o,"");},onAfterOpenPartialDialog:function(){this.focus(p);},onAfterOpenDifferenceDialog:function(){this.focus(n);},onAfterOpenDamageDialog:function(){this.focus(o);},initUoMItems:function(i){var v=this.getUoMSelection();var w=this.byId(i);w.removeAllItems();v.forEach(function(x){w.addItem(x);});w.setSelectedItem(v[0]);},getUoMSelection:function(){var i=this.oItemHelper.getItemAlternativeUoMByIndex(0);var v=this.oItemHelper.getItemBaseUoMByIndex(0);var w=[];w.push(new sap.ui.core.Item({key:b.UOM_TYPE.ALTER,text:i}));if(i!==v){w.push(new sap.ui.core.Item({key:b.UOM_TYPE.BASE,text:v}));}return w;},openPartialPack:function(){var v=this.getView();var D;if(this.oItemHelper.isSerialNumberEnableItem()){D=v.byId("serialNumberPartialPackDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberPartialPackDialog",this);v.addDependent(D);}this.updateInputWithDefault(r,"");S.clearSerialNumbersList();}else{D=v.byId("partialDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.PartialPackDialog",this);v.addDependent(D);}}this.openDialog(D).catch(function(E){});},onPartialPackQuantityChange:function(E){var i=U.trim(E.getParameter("newValue"));if(!U.isEmpty(i)){var Q=U.parseNumber(i);var v=U.formatNumber(Q);var w=U.parseNumber(this.oItemHelper.getItemQuantityByIndex(0));if(U.isEmpty(v)||Q>=w||Q<=0){this.updateInputWithError(p);this.playAudio(b.ERROR);}else{this.updateInputWithDefault(p,v);}}},onExceptionQuantitySubmit:function(E){var i=U.trim(E.getParameter("value"));var v=E.getSource();if(!U.isEmpty(i)){var Q=U.parseNumber(i);this.checkQuantityOverflow(Q,v);}},fireInputChange:function(i,v){i.fireChange({newValue:v});},getNewItemWithPartialQuantity:function(i,R){var N=JSON.parse(JSON.stringify(i));if(N.StockItemUUID!==R.StockItemUUID){N.OriginId=N.StockItemUUID;N.StockItemUUID=R.StockItemUUID;}N.AlterQuan=U.formatNumber(parseFloat(R.DesAlterQuan),3);N.AlternativeUnit=R.DesAlterUoM;N.Quan=U.formatNumber(parseFloat(R.DesQuan),3);N.NetWeight=U.formatNumber(parseFloat(R.DesWeight),3,3);N.WeightUoM=R.DesUnitGw;N.Volume=U.formatNumber(parseFloat(R.DesVolume),3,3);N.VolumeUoM=R.DesUnitGv;return N;},getProductQuantityByUoM:function(i){var v;if(i===b.UOM_TYPE.ALTER){v=U.parseNumber(this.oItemHelper.getItemQuantityByIndex(0));}else{v=U.parseNumber(this.oItemHelper.getItemBaseQtyByIndex(0));}return v;},onPartialPack:function(E){var i=this.byId("partial-uom-select");var v=i.getSelectedKey();var w=i.getSelectedItem().getText();var Q=false;var x={};var y=this.getProductQuantityByUoM(v);var z=this.byId(p);var D=U.trim(z.getValue());if(!U.isEmpty(D)){var F=U.parseNumber(D);var H=U.formatNumber(F);if(U.isEmpty(H)||F>=y||F<=0){Q=true;}else{if(this.checkQuantityOverflow(F,z)){return;}else{this.updateInputWithDefault(p,H);}}}else{Q=true;}if(Q){this.handleEmptyQuantityInput(p,"inputQuantityNotice");return;}var K=E.getSource().getParent();K.setBusy(true);var N=this.oItemHelper.getItemByIndex(0);x.oProduct=N;x.iQuantity=F;x.oDialog=K;x.sUoM=w;x.sUoMType=v;this.getWorkFlowFactory().getPartialPackWorkFlow().run(x);},removeExceptionButtons:function(){var v=this.byId("sourcehu-buttons-toolbar");var w=v.getContent().length;for(var i=w-1;i>0;i--){var x=v.getContent()[i];var y=x.getCustomData();if(y.length!==0){v.removeContent(x);}}},initExceptionButtons:function(E){var i={};var v;var w=this.byId("sourcehu-buttons-toolbar");var x=function(y){var z=y.getSource();var D=z.getText();var F=y.getSource().getCustomData()[0].getValue();var H=y.getSource().getCustomData()[0].getKey();if(F===b.EXCCODE.DIFF){this.openDifference(H,D).catch(function(K){});}else if(F===b.EXCCODE.EXPA){this.openDamage(H,D).catch(function(K){});}}.bind(this);E.forEach(function(y){i=new sap.m.Button({text:y.Descr,enabled:"{path:'global>/exceptionEnable'}",press:x,width:"18%"});i.setTooltip(y.Descr);v=new sap.ui.core.CustomData({key:y.Exccode,value:y.InternalProcessCode});i.addCustomData(v);if(!P.isInternalMode()||y.InternalProcessCode!==b.EXCCODE.EXPA){w.insertContent(i,1);}});},openDamage:function(E,i){var v=this.getView();var D;D=v.byId("damageDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.DamageDialog",this);v.addDependent(D);}D.setTitle(i);D.removeAllCustomData();var w=new sap.ui.core.CustomData({key:E});D.addCustomData(w);return this.openDialog(D);},openDamageDialogWithSerialNumber:function(E,i){var v=this.getView();var D;D=v.byId("serialNumberDamageDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberDamageDialog",this);v.addDependent(D);}this.updateInputWithDefault(t,"");S.clearSerialNumbersList();D.setTitle(i);D.removeAllCustomData();var w=new sap.ui.core.CustomData({key:E});D.addCustomData(w);return this.openDialog(D);},openDifference:function(E,i){var v=this.getView();var D;if(this.oItemHelper.isSerialNumberEnableItem()){D=v.byId("serialNumberDifferenceDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberDifferenceDialog",this);v.addDependent(D);}this.updateInputWithDefault(q,"");S.clearSerialNumbersList();}else{D=v.byId("differenceDialog");if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.DifferenceDialog",this);v.addDependent(D);}}D.setTitle(i);D.removeAllCustomData();var w=new sap.ui.core.CustomData({key:E});D.addCustomData(w);return this.openDialog(D);},onDifferenceQuantityChange:function(E){var i=U.trim(E.getParameter("newValue"));if(!U.isEmpty(i)){var Q=U.parseNumber(i);var v=U.formatNumber(Q);var w=U.parseNumber(this.oItemHelper.getItemQuantityByIndex(0));if(U.isEmpty(v)||Q>=w||Q<0){this.updateInputWithError(n);this.playAudio(b.ERROR);}else{this.updateInputWithDefault(n,v);}}},onDifference:function(E){var i=this.byId("difference-uom-select");var v=i.getSelectedKey();var w=i.getSelectedItem().getText();var x=this.getProductQuantityByUoM(v);var Q=false;var y=this.byId(n);var z=U.trim(y.getValue());if(!U.isEmpty(z)){var D=U.parseNumber(z);var F=U.formatNumber(D);if(U.isEmpty(F)||D>=x||D<0){Q=true;}else{if(this.checkQuantityOverflow(D,y)){return;}else{this.updateInputWithDefault(n,F);}}}else{Q=true;}if(Q){this.handleEmptyQuantityInput(n,"inputQuantityNotice");return;}var H=E.getSource().getParent();var K=H.getCustomData()[0].getKey();var N=this.oItemHelper.getItemByIndex(0);H.setBusy(true);this.getWorkFlowFactory().getDiffPackWorkFlow().run([N,D,K,H,w,v]);},onDamage:function(E){var i=this.byId("damage-uom-select");var v=i.getSelectedKey();var w=i.getSelectedItem().getText();var Q=false;var x=this.getProductQuantityByUoM(v);var y=this.byId(o);var z=U.trim(y.getValue());if(!U.isEmpty(z)){var D=U.parseNumber(z);var F=U.formatNumber(D);if(U.isEmpty(F)||D>x||D<=0){Q=true;}else{if(this.checkQuantityOverflow(D,y)){return;}else{this.updateInputWithDefault(o,F);}}}else{Q=true;}if(Q){this.handleEmptyQuantityInput(o,"inputQuantityNotice");return;}var H=E.getSource().getParent();var K=H.getCustomData()[0].getKey();var N=H.getTitle();var R=this.oItemHelper.getItemByIndex(0);D=U.parseNumber(R.AlterQuan)-D;if(this.oItemHelper.isSerialNumberEnableItem()&&D!==0){H.close();this.openDamageDialogWithSerialNumber(K,N);}else{H.setBusy(true);this.getWorkFlowFactory().getDiffPackWorkFlow().run([R,D,K,H,w,v]);}},onSerialNumberExceptionChange:function(E,i){var v=U.trim(E.getParameter("newValue"));if(U.isEmpty(v)){return;}if(v.length>30){this.handleEntryLengthExceed(i);return;}if(S.getSerialNumberCount()===this.oItemHelper.getItemBaseQtyByIndex(0)-1){var w=this.getI18nText("overPackErrorMsg",this.oItemHelper.getItemBaseQtyByIndex(0));this.updateInputWithError(i,w);this.playAudio(b.ERROR);this.focus(i);return;}v=v.toUpperCase();this.verifySerialNumber(v,i);},verifySerialNumber:function(i,v){var w=this.getSerialNumberVerifyPromise(i);w.then(function(x){S.addSerialNumber(i);this.updateInputWithDefault(v,"");this.focus(v);}.bind(this)).catch(function(E){this.updateInputWithError(v,E.getDescription());this.playAudio(b.ERROR);this.focus(v);}.bind(this));},onSerialNumberDifferenceChange:function(E){this.onSerialNumberExceptionChange(E,q);},onSerialNumberPartialPackChange:function(E){this.onSerialNumberExceptionChange(E,r);},onSerialNumberDamageChange:function(E){this.onSerialNumberExceptionChange(E,t);},onSerialNumberDifferencePack:function(E){var D=E.getSource().getParent();var i=D.getCustomData()[0].getKey();var v=JSON.parse(JSON.stringify(this.oItemHelper.getItemByIndex(0)));D.setBusy(true);var Q=S.getSerialNumberCount()/this.oItemHelper.getAlternativeUOMRatio(v);Q=U.parseNumber(U.formatNumber(Q,3));this.getWorkFlowFactory().getDiffPackWorkFlow().run([v,Q,i,D]);},onSerialNumberDamagePack:function(E){var D=E.getSource().getParent();var i=D.getCustomData()[0].getKey();var v=JSON.parse(JSON.stringify(this.oItemHelper.getItemByIndex(0)));D.setBusy(true);var Q=S.getSerialNumberCount()/this.oItemHelper.getAlternativeUOMRatio(v);Q=U.parseNumber(U.formatNumber(Q,3));this.getWorkFlowFactory().getDiffPackWorkFlow().run([v,Q,i,D]);},onSerialNumberPartialPack:function(E){var D=E.getSource().getParent();var Q=S.getSerialNumberCount();var i={};if(Q===0){this.handleEmptyQuantityInput(r,"noSNForPartialPackErr");return;}D.setBusy(true);var v=JSON.parse(JSON.stringify(this.oItemHelper.getItemByIndex(0)));i.oProduct=v;var w=Q/this.oItemHelper.getAlternativeUOMRatio(v);i.iQuantity=U.parseNumber(U.formatNumber(w,3));i.oDialog=D;this.getWorkFlowFactory().getPartialPackWorkFlow().run(i);},clearSourceBeforeLeave:function(){this.updateInputWithDefault(b.ID.SOURCE_INPUT,"");this.updateInputWithDefault(b.ID.PRODUCT_INPUT,"");G.setSourceId("");G.setProductId("");this.oItemHelper.setItems([]);},unbindODOInfo:function(){this.oODOForm.unbindElement();},disableButtons:function(){G.setPackAllEnable(false);G.setExceptionEnable(false);},bindODOInfo:function(){this.oODOForm.bindElement(b.ITEM_MODEL_NAME+">/0");},setHandlingInstrElementVisible:function(v){var F=this.oODOForm.getFormElements()[2];F.setVisible(v);},getSerialNumberDialog:function(){var v=this.getView();var D=v.byId(s);if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.SerialNumberDialog",this);v.addDependent(D);}this.updateInputWithDefault(h,"");S.clearSerialNumbersList();return D;},getStockLevelSnDialog:function(i){var v=this.getView();var D=v.byId(j);if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.StockLevelSnDialog",this);v.addDependent(D);}D.removeAllCustomData();var w=new sap.ui.core.CustomData({key:i});D.addCustomData(w);var x=v.byId("stockLevel-sn-dialog-text");this.setDialogText(x,"stockLevelSerialNumberNotification");this.updateInputWithDefault(k,"");return D;},onStockLevelSNChange:function(E){var D=E.getSource().getParent().getParent();var i=D.getCustomData()[0].getKey();var v=U.trim(E.getParameter("value")).toUpperCase();if(!U.isEmpty(v)){var w=this.oItemHelper.getItemIndexBySerialNumber(i,v);if(w!==-1){this.closeDialog(D,w,false);return;}}var x=this.getI18nText("incorrectStockLevelSn");this.updateInputWithError(k,x);this.playAudio(b.ERROR);this.focus(k);},onCancelStockLevelSNialog:function(E){this.updateInputWithDefault(k,"");this.closeDialog(E.getSource().getParent(),b.ERRORS.INTERRUPT_WITH_NO_ACTION,true);},getSerialNumberVerifyPromise:function(i){var v;var E;var w;if(U.isEmpty(i)){E=this.getI18nText("emptySN");w=new a("",E);v=U.getRejectPromise(w);}else if(S.hasSerialNumber(i)){E=this.getI18nText("duplicateSNMsg",i);w=new a("",E);v=U.getRejectPromise(w);}else{if(this.oItemHelper.isStockLevelSerialNumber()){if(this.oItemHelper.hasSerialNumber(i)){v=U.getResolvePromise(i);}else{E=this.getI18nText("incorrectSerialNumber",i);w=new a("",E);v=U.getRejectPromise(w);}}else{v=e.verifySerialNumber(this.oItemHelper.getItemByIndex(0),i);}}return v;},onBatchNumberChange:function(E){var D=E.getSource().getParent().getParent();var i=D.getCustomData()[0].getKey();var v=U.trim(E.getParameter("value")).toUpperCase();var w=false;if(!U.isEmpty(v)){var x=this.oItemHelper.getItemIndexByProductAndBatch(i,v);if(x!==-1){this.updateInputWithDefault(m,"");this.closeDialog(D,v,false);}else{w=true;}}else{w=true;}if(w){var y=this.getI18nText("batchIncorrect");this.updateInputWithError(m,y);this.playAudio(b.ERROR);this.focus(m);}},getBatchNumberDialog:function(i){var v=this.getView();var D=v.byId(l);if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.BatchNumberDialog",this);v.addDependent(D);}D.removeAllCustomData();var w=new sap.ui.core.CustomData({key:i});D.addCustomData(w);var x=v.byId("batch-dialog-text");this.setDialogText(x,"batchNumberNotification",[i]);return D;},setDialogText:function(i,v,w){var x=this.getI18nText(v,w);i.setText(x);},onCancelBatchDialog:function(E){this.updateInputWithDefault(m,"");this.closeDialog(E.getSource().getParent(),b.ERRORS.INTERRUPT_WITH_NO_ACTION,true);},onSerialNumberCancel:function(E){this.closeDialog(E.getSource().getParent(),b.ERRORS.INTERRUPT_WITH_NO_ACTION,true);this.oItemHelper.setItemQtyReducedInitialized();this.oItemHelper.setItemReductCancelByIndex(0);this.setBusy(false);},handleEmptyQuantityInput:function(i,v){var E=this.getI18nText(v);this.updateInputWithError(i,E);this.playAudio(b.ERROR);this.focus(i);},handleExceptionEnable:function(){if(U.isEmpty(G.getSourceId())||this.oItemHelper.isEmpty()||U.isEmpty(G.getProductId())){G.setExceptionEnable(false);return;}var i=G.getCurrentShipHandlingUnit();if(G.getPendingTaskNumber()===0&&!U.isEmpty(i)&&!O.isShipHUClosed(i)){var v=this.oItemHelper.getFirstItemConsGroup();var w=c.getShipHUConsGroup(i);if(w===v||w===""){G.setExceptionEnable(true);}else{G.setExceptionEnable(false);}}else{G.setExceptionEnable(false);}},getChangePackQuantityDialog:function(i){var v=this.getView();var D=v.byId(u);var w;if(!D){D=sap.ui.xmlfragment(v.getId(),"zscm.ewm.packoutbdlvs1.view.ChangePackingQuantityDialog",this);v.addDependent(D);}D.removeAllCustomData();if(this.oItemHelper.getItemReductionQtyByIndex(0)==="0"){w=this.getI18nText("orderCancelNotification");}else{w=this.getI18nText("changePackingQuantityNotification",[this.oItemHelper.getItemQuantityByIndex(0),this.oItemHelper.getItemReductionQtyByIndex(0)]);}var x=v.byId("reduction-dialog-text");x.setText(w);this.playAudio(b.WARNING);return D;},onProcessOrderReduction:function(E){this.closeDialog(E.getSource().getParent());var i=this.oItemHelper.getItemByIndex(0);var v={oProduct:i};this.getWorkFlowFactory().getPackItemWorkFlow().run(v);},onNotProcessOrderReduction:function(E){this.closeDialog(E.getSource().getParent());this.oItemHelper.setItemQtyReducedInitialized();},onDamageQuantityChange:function(E){var i=U.trim(E.getParameter("newValue"));var v=false;if(!U.isEmpty(i)){var Q=U.parseNumber(i);var w=U.formatNumber(Q);var x=U.parseNumber(this.oItemHelper.getItemQuantityByIndex(0));if(U.isEmpty(w)||Q>x||Q<=0){v=true;}else{this.updateInputWithDefault(o,w);}}else{v=true;}if(v){var y=this.getI18nText("inputQuantityNotice");this.updateInputWithError(o,y);this.playAudio(b.ERROR);}},onAfterCloseDialog:function(E){var i=E.getSource().getContent()[0].getContent()[2].getContent()[0].setValue("");this.updateInputWithDefault(i,"");this.focus(b.ID.PRODUCT_INPUT);},onSerialNumberPopover:function(E){this.openSerialNumberPopover(E,b.ITEM_MODEL_NAME,this.oItemHelper);},onSerialNumberPack:function(E){var D=E.getSource().getParent();var i=this.byId(h).getValue();if(!U.isEmpty(i)){this.verifySerialNumberInput(i,D).then(function(){this.handleSerialNumberPack();}.bind(this));}else{this.handleSerialNumberPack();}},handleSerialNumberPack:function(){if(!this.isAllSerialNumberFinished()){var E=U.parseNumber(this.oItemHelper.getItemBaseQtyByIndex(0));var i=this.getI18nText("provideAllSNs",E);this.updateInputWithError(h,i);this.playAudio(b.ERROR);this.focus(h);}},onDeleteSerialNumber:function(E){var i=E.getParameter("listItem");var v=i.getTitle();S.removeSerialNumber(v);this.updateInputWithDefault(h,"");this.focus(h);},onSerialNumChange:function(E){var i=U.trim(E.getParameter("value"));var D=E.getSource().getParent().getParent();this.verifySerialNumberInput(i,D);},verifySerialNumberInput:function(i,D){i=i.toUpperCase();if(i.length>30){this.handleEntryLengthExceed(h);return;}return new Promise(function(v,w){D.setBusy(true);var x;x=this.getSerialNumberVerifyPromise(i);x.then(function(y){D.setBusy(false);S.addSerialNumber(i);this.updateInputWithDefault(h,"");this.focus(h);if(this.isAllSerialNumberFinished()){this.closeDialog(D);}v();}.bind(this)).catch(function(E){D.setBusy(false);this.updateInputWithError(h,E.getDescription());this.playAudio(b.ERROR);this.focus(h);}.bind(this));}.bind(this));},handleEntryLengthExceed:function(i){var E=this.getI18nText("serialNumberMaximunCharacters");this.updateInputWithError(i,E);this.playAudio(b.ERROR);this.focus(i);},isAllSerialNumberFinished:function(){var i=S.getSerialNumberCount();var E=U.parseNumber(this.oItemHelper.getItemBaseQtyByIndex(0));if(i===E){return true;}return false;},formatPackBtn:function(v){if(v===sap.ui.core.MessageType.Success){return true;}return false;},formatSerialNumberPackMsg:function(i,v){return this.getTextAccordingToMode("serialNumberPackText","serialNumberPackNotification",[i],v);},formatExceptionMsg:function(i,v){return this.getTextAccordingToMode("internalExceptionDialogText","exceptionDialogText",[i],v);},formatSerialNumQtyDisplay:function(i,Q){if(Q===undefined){return"";}return S.getSerialNumberCount()+"/"+Q;},formatSNListMode:function(i){if(i!==undefined&&this.oItemHelper.isStockLevelSerialNumber()){return L.None;}else{return L.Delete;}},isSelectedItemAndCurrentShipHUInSameConsGroup:function(i){var v=false;if(!U.isEmpty(G.getProductId())){var w=c.getShipHUConsGroup(G.getCurrentShipHandlingUnit());if(U.isEmpty(w)||i===w){v=true;}}return v;},updateSourceItemStatus:function(){if(U.isEmpty(G.getProductId())){this.oItemHelper.setItemsStatusByConsGrp();return;}if(this.canFirstSourceItemPackToCurrentShipHU()){this.oItemHelper.setItemHighlightByIndex(0);}else{this.oItemHelper.setItemsStatusByConsGrp();}return;},formatSourceHUEnabled:function(i){if(i>0){return false;}return true;},onSourceItemPressed:function(E){var i=E.getSource().getBindingContext("itemModel");var v=i.getObject();this.getWorkFlowFactory().getProductChangeWorkFlow().run(v);},formatHandlingInstruction:function(H,i){if(U.isEmpty(i)){return"";}return H;},showErrorMessagePopup:function(i){var v=!!this.getView().$().closest(".sapUiSizeCompact").length;var w=this.getView().byId(b.ID.PRODUCT_INPUT);M.error(i,{styleClass:v?"sapUiSizeCompact":"",actions:[sap.m.MessageBox.Action.OK],onClose:function(){this.focus(w);}.bind(this)});},formatBaseUoMVisible:function(i){if(!U.isEmpty(i)&&i.AlternativeUnit===i.BaseUnit){return false;}return true;},initColumnSettingModel:function(){this.oColumnSettingsHelper.setData(this.getDefaultColumnSetting());},canFirstSourceItemPackToCurrentShipHU:function(){var v=false;var i=G.getCurrentShipHandlingUnit();var w=G.getCurrentShipHandlingUnitClosed();if(U.isEmpty(i)||w){return false;}var x=this.oItemHelper.getFirstItemConsGroup();var y=c.getShipHUConsGroup(i);if(U.isEmpty(y)){if(!U.isEmpty(x)&&c.getIsEmptyHU(i)){v=true;}else if(U.isEmpty(x)){v=true;}}else if(y===x){v=true;}return v;},initDefaultColumnSetting:function(){this._mAdvancedSourceTableDefaultSettings=JSON.parse(JSON.stringify(A.getData()));this._mBasicSourceDefaultDefaultSettings=JSON.parse(JSON.stringify(B.getData()));this._mInternalSourceTableDefaultSettings=JSON.parse(JSON.stringify(I.getData()));},formatProductText:function(i,v){if(!U.isEmpty(i)){return v+" ("+i+")";}else{return"";}}});});
