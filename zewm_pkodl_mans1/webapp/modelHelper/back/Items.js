/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["zscm/ewm/packoutbdlvs1/utils/Util","zscm/ewm/packoutbdlvs1/utils/Const","zscm/ewm/packoutbdlvs1/modelHelper/Global","zscm/ewm/packoutbdlvs1/modelHelper/PackingMode"],function(U,C,G,P){"use strict";function I(m){this._oModel=m;}jQuery.extend(I.prototype,Error.prototype,{constructor:I,getModel:function(){return this._oModel;},setItems:function(i){this.initOrigId(i);this._oModel.setData(i);return this;},isStockLevelSnEnabledByIndex:function(i){var o=this._oModel.getData()[i];return o.SerialNumberRequiredLevel===C.SERIAL_NUMBER_STOCK_LEVEL;},getItemIndexBySerialNumber:function(p,s){var o=this._oModel.getData();var i=U.findIndex(o,function(a,b){if(a.SerialNumberRequiredLevel===C.SERIAL_NUMBER_STOCK_LEVEL&&a.ProductName===p){if(this.isSerialNumberInSnListByIndex(b,s)){return true;}}return false;}.bind(this));return i;},initOrigId:function(i){i.forEach(function(o){if(U.isEmpty(o.OriginId)){o.OriginId=o.StockItemUUID;}});},getAllItemsByProduct:function(p){var i=[];var o=this._oModel.getData();o.forEach(function(a){if(a.ProductName===p){i.push(a);}});return i;},isItemWithBatch:function(v){var i=this.getItemIndexByProduct(v);var p=this._oModel.getData();return!U.isEmpty(p[i].Batch);},getItemProductByIndex:function(i){return this._oModel.getData()[i].ProductName;},getItemByIndex:function(i){return this._oModel.getData()[i];},getItemDocIdByIndex:function(i){return this._oModel.getData()[i].DocumentReltdStockDocUUID;},getItemItmIdByIndex:function(i){return this._oModel.getData()[i].DocumentReltdStockDocItemUUID;},getItemStockIdByIndex:function(i){return this._oModel.getData()[i].StockItemUUID;},getItemDocNoByIndex:function(i){return this._oModel.getData()[i].EWMRefDeliveryDocumentNumber;},getItemQuantityByIndex:function(i){return this._oModel.getData()[i].AlterQuan;},getItemBaseQtyByIndex:function(i){return this._oModel.getData()[i].Quan;},getItemAlternativeUoMByIndex:function(i){return this._oModel.getData()[i].AlternativeUnit;},getItemBaseUoMByIndex:function(i){return this._oModel.getData()[i].BaseUnit;},getItemReductionQtyByIndex:function(i){return U.formatNumber((U.parseNumber(this._oModel.getData()[i].AlterQuan)-U.parseNumber(this._oModel.getData()[i].QtyReduced)),3);},isReductionFirstItem:function(){var p=this.getItemByIndex(0);var r=false;if(U.parseNumber(p.QtyReduced)!==0){if(p.SerialNumberRequiredLevel===C.SN_DOC_LEVEL_PROFILE_A||p.SerialNumberRequiredLevel===C.SERIAL_NUMBER_DISABLE){r=true;}}return r;},updateItemQuantityByIndex:function(i,a,b){var n=U.formatNumber(parseFloat(a),3);var N=U.formatNumber(parseFloat(b),3);this._oModel.setProperty("/"+i+"/AlterQuan",n);this._oModel.setProperty("/"+i+"/Quan",N);},updateItemWeightByIndex:function(i,w,W){this._oModel.setProperty("/"+i+"/NetWeight",U.formatNumber(parseFloat(w),3,3));this._oModel.setProperty("/"+i+"/WeightUoM",W);},updateItemVolumeByIndex:function(i,v,V){this._oModel.setProperty("/"+i+"/Volume",U.formatNumber(parseFloat(v),3,3));this._oModel.setProperty("/"+i+"/VolumeUoM",V);},sortItemsByKey:function(s){var p=this._oModel.getData();var o=[];var a;var b=U.find(p,function(c,d){a=d;if(c.StockItemUUID===s){return true;}return false;});if(!b){return;}o.push(b);p.splice(a,1);for(var i=0;i<p.length;i++){var c=p[i];if(c.EWMConsolidationGroup===b.EWMConsolidationGroup){o.push(c);p.splice(i,1);i--;}}this.setItems(o.concat(p));},getItemIndexByKey:function(s){var i=this._oModel.getData();var a=U.findIndex(i,function(b){if(b.StockItemUUID===s){return true;}return false;});return a;},getItemIndexByProductAndActiveConsGroup:function(p,c){var i=this._oModel.getData();var a=U.findIndex(i,function(b){if(b.StockItemUUID===p.StockItemUUID&&c===b.EWMConsolidationGroup){return true;}return false;});return a;},getItemIndexByProductActiveConsGroupAndBatch:function(p,c,b){var i=this._oModel.getData();var a=U.findIndex(i,function(d){if(d.ProductName===p&&c===d.EWMConsolidationGroup&&b===d.Batch){return true;}return false;});return a;},getItemIndexByProductAndBatch:function(p,b){var i=this._oModel.getData();var a=U.findIndex(i,function(c){if(c.ProductName===p&&b===c.Batch){return true;}return false;});return a;},getItemIndexByProduct:function(p){var i=this._oModel.getData();var a=U.findIndex(i,function(b){if(b.ProductName===p){return true;}return false;});return a;},updateItemStockId:function(i,s){if(!U.isEmpty(s)){i.OriginId=i.StockItemUUID;i.StockItemUUID=s;}return i;},updateItemStockIdByKey:function(o,n){var i=this.getAllItems();var a;var r=U.find(i,function(b,c){if(b.StockItemUUID===o){a=c;return true;}return false;});if(r){i[a].StockItemUUID=n;}},getItemStockIdByOriginalId:function(o){var i=this.getAllItems();var r=U.find(i,function(a){if(a.OriginId===o){return true;}return false;});if(r){return r.StockItemUUID;}return"";},addItem:function(p,c){p=this.mergeItem(p,c);var a=this._oModel.getData();a=a.slice(0);a.unshift(p);this.setItems(a);},addItemWithoutMerge:function(p){var a=this._oModel.getData();a=a.slice(0);a.unshift(p);this.setItems(a);},updateItem:function(n){var i=this.getAllItems();var a;var r=U.find(i,function(o,b){if(o.StockItemUUID===n.StockItemUUID){a=b;return true;}return false;});if(r){n.SnList=U.trim(n.SnList+" "+r.SnList);n.IuidList=U.trim(n.IuidList+" "+r.IuidList);i[a]=n;}else{i.unshift(n);}this.setItems(i);this._oModel.updateBindings(true);},mergeItem:function(p,c){var a=this._oModel.getData();var r;if(c){r=this.findItemAndIndexByStockIdAndOriginId(p.StockItemUUID,p.OriginId);}else{r=this.findItemAndIndexByStockId(p.StockItemUUID);}var e=r[0];var i=r[1];if(e){if(p.AlternativeUnit!==e.AlternativeUnit){p.AlterQuan=p.Quan;p.AlternativeUnit=p.BaseUnit;}p.Quan=U.formatNumber(U.parseNumber(p.Quan)+U.parseNumber(e.Quan),3);p.AlterQuan=U.formatNumber(U.parseNumber(p.AlterQuan)+U.parseNumber(e.AlterQuan),3);p.SnList=U.trim(p.SnList+" "+e.SnList);p.IuidList=U.trim(p.IuidList+" "+e.IuidList);a.splice(i,1);}return p;},findItemAndIndexByStockId:function(s){var i=this.getAllItems();var a=-1;var p=U.find(i,function(o,b){if(o.StockItemUUID===s){a=b;return true;}return false;});return[p,a];},findItemAndIndexByStockIdAndOriginId:function(s,o){var i=this.getAllItems();var a=-1;var p=U.find(i,function(b,c){if(b.StockItemUUID===s&&b.OriginId===o){a=c;return true;}return false;});return[p,a];},deleteItem:function(i){var p=this._oModel.getData();var a=this.getItemIndexByKey(i.StockItemUUID);p=p.slice(0);if(a!==-1){p.splice(a,1);}this.setItems(p);},addAllItems:function(p){p.forEach(function(o){this.addItem(o);}.bind(this));},clear:function(){this.setItems([]);},isEmpty:function(){var p=this._oModel.getData();return p.length===0;},setItemsStatusByConsGrp:function(){var p=this._oModel.getData();if(p.length===0){return;}var c=p[0].EWMConsolidationGroup;if(U.isEmpty(c)){this.setItemsStatusToNone();if(!P.isInternalMode()||!U.isEmpty(G.getProductId())&&U.isEmpty(G.getCurrentShipHandlingUnit())){p[0].Status=sap.ui.core.MessageType.Information;}}else{p.map(function(i,a){if(c!==""&&i.EWMConsolidationGroup===c){i.Status=sap.ui.core.MessageType.Information;}else{i.Status=sap.ui.core.MessageType.None;}});}this.setItems(p);},setItemsStatusToNone:function(){var p=this._oModel.getData();if(p.length===0){return;}p.map(function(i,a){i.Status=sap.ui.core.MessageType.None;});this.setItems(p);},setItemHighlightByIndex:function(i){var p=this._oModel.getData();if(p.length===0){return;}var o=this.getItemByIndex(i);if(o){this._oModel.setProperty("/"+i+"/Status",sap.ui.core.MessageType.Success);}},getHighLightedItem:function(){var i=this._oModel.getData();var p=U.find(i,function(o){if(o.Status===sap.ui.core.MessageType.Success){return true;}return false;});return p;},getHighLightedItemIndex:function(){var i=this._oModel.getData();var a=U.findIndex(i,function(o){if(o.Status===sap.ui.core.MessageType.Success){return true;}return false;});return a;},isSingleConsGroupNoReduction:function(){var i=this.getModel().getData();if(i.length!==0){var c=i[0].EWMConsolidationGroup;var r=U.find(i,function(o){if(o.EWMConsolidationGroup!==c||U.parseNumber(o.QtyReduced)!==0){return true;}});if(r){return false;}return true;}else{return false;}},getFirstItemConsGroup:function(){var i=this._oModel.getData();if(i.length!==0){return i[0].EWMConsolidationGroup;}},isFirstItemHighlighted:function(){var i=this._oModel.getData();if(i.length>0){if(i[0].Status===sap.ui.core.MessageType.Success){return true;}}return false;},getItemsNum:function(){return this._oModel.getData().length;},getAlternativeUOMRatio:function(i){var a=U.parseNumber(i.AlterQuan);var b=U.parseNumber(i.Quan);return U.parseNumber(U.formatNumber(b/a,3));},isSerialNumberEnable:function(){var i=this._oModel.getData();var p=U.find(i,function(m){if(m.SerialNumberRequiredLevel===C.SERIAL_NUMBER_DISABLE||(m.SerialNumberRequiredLevel===C.SN_DOC_LEVEL_PROFILE_A&&m.EWMDeliveryDocumentCategory!==C.DOCUMENT_CAT_OUTBOUND)){return false;}else{return true;}});return!!p;},isBatchEnable:function(){var i=this._oModel.getData();var p=U.find(i,function(m){if(U.isEmpty(m.Batch)){return false;}return true;});return!!p;},isStockLevelSerialNumber:function(){return this._oModel.getData()[0].SerialNumberRequiredLevel===C.SERIAL_NUMBER_STOCK_LEVEL;},getSerialNumberListByIndex:function(i){var o=this.getItemByIndex(i);return this.getItemSerialNumber(o);},getItemSerialNumber:function(i){return this.parseSerialNumber(i.SnList);},getItemSerialNumberUii:function(i){return this.parseSerialNumberUii(i.SnList,i.IuidList);},getItemCountByProduct:function(p){var i=this._oModel.getData();var c=0;i.forEach(function(o){if(o.ProductName===p){c++;}});return c;},hasMutlipleBatchesByProduct:function(p){var i=this._oModel.getData();var b="";var h=false;U.find(i,function(o){if(o.ProductName===p){if(U.isEmpty(b)){b=o.Batch;}if(b!==o.Batch){h=true;return true;}return false;}return false;});return h;},getItemSerialNumberCountByIndex:function(i){var o=this.getItemByIndex(i);return this.getItemSerialNumber(o).length;},isSerialNumberFullyAssignedByIndex:function(i){var s=this.getItemSerialNumberCountByIndex(i);return s===U.parseNumber(this.getItemBaseQtyByIndex(i));},hasSerialNumber:function(s){var S=this.getSerialNumberListByIndex(0);return S.indexOf(s)>-1;},removeSerialNumberFromItem:function(r,i){var s;if(U.isEmpty(i)){s=this.getSerialNumberListByIndex(0);}else{s=this.parseSerialNumber(i.SnList);}r.forEach(function(S){var a=s.indexOf(S);if(a===-1){return;}s=s.slice(0);s.splice(a,1);});if(U.isEmpty(i)){this._oModel.getData()[0].SnList=U.formatSerialNumber(s);}else{i.SnList=U.formatSerialNumber(s);}},removeIuidFromItem:function(o,r){var a;var R=this.parseSerialNumber(r);if(U.isEmpty(o)){a=this.parseSerialNumber(this.getItemByIndex(0).IuidList);}else{a=this.parseSerialNumber(o.IuidList);}var b;for(var i=0;i<R.length;i++){b=a.indexOf(R[i]);if(b!==-1){a.splice(b,1);}}if(U.isEmpty(o)){this.getItemByIndex(0).IuidList=a.join(" ");}else{o.IuidList=a.join(" ");}},parseSerialNumber:function(s){if(U.isEmpty(s)){return[];}else{return s.split(" ");}},parseSerialNumberUii:function(s,u){if(U.isEmpty(s)){return[];}else{var S=[];var a=s.split(" ");var b=u.split(" ");for(var i=0;i<a.length;i++){var o={};o.SerialNum=a[i];o.UniqueItemIdentifier=b[i]===""?" ":b[i];S.push(o);}return S;}},removeSerialNumberFromCurrentItem:function(r){var s=this.getSerialNumberListByIndex(0);r.forEach(function(S){var i=s.indexOf(S);if(i===-1){return;}s.splice(i,1);});this._oModel.getData()[0].SnList=U.formatSerialNumber(s);},removeSerialNumberUiiFromCurrentItem:function(s,r){var a=this.getItemByIndex(0).IuidList;var b=U.isEmpty(a)?[]:a.split(" ");var c;for(var i=0;i<r.length;i++){c=s.indexOf(r[i]);if(c!==-1){b.splice(c,1);}}this.getItemByIndex(0).IuidList=b.join(" ");},removeSerialNumberFromOtherItems:function(p,r){var a=this.getItemsIndexByProduct(p);a.forEach(function(b){if(r.length===0){return;}var c=false;for(var i=0;i<r.length;i++){if(this.isSerialNumberInSnListByIndex(b,r[i])){c=true;r.splice(i,1);i--;}}if(c){this.clearSnListByIndex(b);}}.bind(this));},isSerialNumbersAllInSnListByIndex:function(i,s){var S=this.getSerialNumberListByIndex(i);if(S.length===0){return false;}var b=true;U.find(s,function(o){var a=S.indexOf(o);if(a===-1){b=false;return false;}});return b;},isSerialNumberInSnListByIndex:function(i,s){var S=this.getSerialNumberListByIndex(i);var a=S.indexOf(s);return a!==-1;},clearSnListByIndex:function(i){this._oModel.getData()[i].SnList="";},getItemsIndexByProduct:function(p){var i=this._oModel.getData();var a=[];i.forEach(function(o,b){if(o.ProductName===p){a.push(b);}});return a;},isSerialNumberEnableItem:function(){var i=this.getItemByIndex(0);if(i.SerialNumberRequiredLevel===C.SERIAL_NUMBER_DISABLE||(i.SerialNumberRequiredLevel===C.SN_DOC_LEVEL_PROFILE_A&&i.EWMDeliveryDocumentCategory!==C.DOCUMENT_CAT_OUTBOUND)){return false;}else{return true;}},setFirstItemReductionQuantity:function(){var p=this.getItemByIndex(0);var r=this.getAlternativeUOMRatio(p);p.AlterQuan=(U.parseNumber(p.AlterQuan)-U.parseNumber(p.QtyReduced)).toString();p.Quan=U.formatNumber(p.AlterQuan*r,3);},setItemQtyReducedInitialized:function(){var p=this.getItemByIndex(0);if(p){p.QtyReduced="0";}},updateItemBothAlterQuantity:function(i,q){i.AlterQuan=q;i.PreviousAlterQuan=q;this._oModel.updateBindings(true);},getAllItems:function(){return this.getModel().getData();},isItemsContainsBatchOrSN:function(){var i=this.getAllItems();var r=U.find(i,function(o){if(!U.isEmpty(o.SerialNumberRequiredLevel)||!U.isEmpty(o.Batch)){return true;}return false;});if(r){return true;}return false;},reduceItemAlterQtyByIndex:function(i,q){var p=this.getItemByIndex(i);p.AlterQuan=(U.parseNumber(p.AlterQuan)-U.parseNumber(q)).toString();},isItemsContainsConsGroup:function(c){var i=this.getAllItems();var r=U.find(i,function(o){if(o.EWMConsolidationGroup===c){return true;}return false;});if(r){return true;}return false;},setItemReductCancelByIndex:function(i){var p=this.getItemByIndex(i);if(p.QuanDefault){this._oModel.setProperty("/"+i+"/Quan",p.QuanDefault);}},setItemReductBaseQuanByIndex:function(i,q){this._oModel.setProperty("/"+i+"/Quan",q);},setItemPreviousAlterQuanByIndex:function(i,v){var p=this.getItemByIndex(i);this._oModel.setProperty("/"+i+"/PreviousAlterQuan",v);},getItemPreviousAlterQuanByIndex:function(i){var p=this.getItemByIndex(i);return!!p.PreviousAlterQuan?p.PreviousAlterQuan:"0";},setItemsPreviousAlterQuan:function(){var i=this.getAllItems();i.map(function(o){o.PreviousAlterQuan=o.AlterQuan;});},getItemByKey:function(s){var i=this._oModel.getData();var r=U.find(i,function(o){if(o.StockItemUUID===s){return true;}return false;});return r;},updatePendingStatus:function(p,b){var i=this.findItemAndIndexByStockIdAndOriginId(p.StockItemUUID,p.OriginId)[0];if(i){i.Pending=b;this._oModel.updateBindings(true);}},updateHighlightStatus:function(p,s){var i=this.getItemByKey(p.StockItemUUID);if(i){i.Status=s;}this._oModel.updateBindings(true);},setItemsDeltaQuan:function(){var i=this.getAllItems();i.map(function(o){o.OperationDeltaQuan=U.parseNumber(o.AlterQuan);});this.setItems(i);},setItemsPackedQuan:function(){var i=this.getAllItems();i.map(function(o){o.PackedQuan=U.parseNumber(o.AlterQuan);});this.setItems(i);},setItemsDefaultQuan:function(i){var a=this.getAllItems();a.map(function(o){if(i&&i.length!==0){var m=U.find(i,function(b){if(o.StockItemUUID===b.StockItemUUID){return true;}return false;});if(m&&m.DefaultAltQuan!==o.DefaultAltQuan){o.DefaultAltQuan=m.DefaultAltQuan;}}else{o.DefaultAltQuan=U.parseNumber(o.AlterQuan);}});this.setItems(a);},resetItemsDefaultQuan:function(i){i.OperationDeltaQuan=i.PackedQuan!==undefined?i.PackedQuan:0;},setItemDeltaByIndex:function(i,q,o){var a=this.getItemByIndex(i);this._oModel.setProperty("/"+i+"/OperationDeltaQuan",a.OperationDeltaQuan>=0?a.OperationDeltaQuan:0);if(o===C.OPERATOR.PLUS){a.OperationDeltaQuan=a.OperationDeltaQuan+q;}else if(o===C.OPERATOR.MINUS){a.OperationDeltaQuan=a.OperationDeltaQuan-q;}else{a.OperationDeltaQuan=q;}},getItemDeltaByIndex:function(i){var o=this.getItemByIndex(i);return o.OperationDeltaQuan;},setItemDefaultQuanByIndex:function(i,q){this._oModel.setProperty("/"+i+"/DefaultAltQuan",q);},getItemDefaultQuanByIndex:function(i){var o=this.getItemByIndex(i);return o.DefaultAltQuan;},getItemPackEnableByIndex:function(i){var o=this.getItemByIndex(i);return o.DefaultAltQuan===o.OperationDeltaQuan;},setItemPackedQuanByIndex:function(i,q){this._oModel.setProperty("/"+i+"/PackedQuan",q);},setItemPackedQuan:function(i,q){var p=this.findItemAndIndexByStockIdAndOriginId(i.StockItemUUID,i.OriginId)[0];p.PackedQuan=q;},getItemPackedQuanByIndex:function(i){var o=this.getItemByIndex(i);return o.PackedQuan;},getItemConsGroupByIndex:function(i){var a=this._oModel.getData();if(!U.isEmpty(a[i])){return a[i].EWMConsolidationGroup;}},getItemPackInstrByIndex:function(i){var a=this._oModel.getData();if(!U.isEmpty(a[i])){return a[i].PackInstr;}},getItemHandlingInstrByIndex:function(i){var a=this._oModel.getData();if(!U.isEmpty(a[i])){return a[i].HandlingInstr;}},updateItemQuantity:function(i,q,m){var r=this.getAlternativeUOMRatio(i);var n;if(m===true){n=U.formatNumber(U.parseNumber(i.AlterQuan)-q,3);}else{n=U.formatNumber(q,3);}i.AlterQuan=n;i.Quan=U.formatNumber(U.parseNumber(n)*r,3);this._oModel.updateBindings(true);},isItemSplitEnable:function(){var i=this._oModel.getData();var p=U.find(i,function(o){if(U.isAbapTrue(o.isSplit)){return true;}return false;});return!!p;},});return I;});
